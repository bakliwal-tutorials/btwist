
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>BTwist - Email Management System</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#4285f4">
  <meta name="apple-mobile-web-app-title" content="BTwist">
  <meta name="application-name" content="BTwist">
  <meta name="msapplication-TileColor" content="#4285f4">
  <meta name="msapplication-config" content="browserconfig.xml">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="./attached_assets/Screenshot 2025-09-23 213415_1758644247005.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="./attached_assets/Screenshot 2025-09-23 213415_1758644247005.png">
  
  <!-- Google Fonts and Material Icons via CDN -->
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Inline CSS for deployment -->
  <style>
    /* Import all CSS content here for static deployment */
  </style>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  
  <!-- EmailJS CDN with multiple fallbacks -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // Enhanced fallback loading for static deployment
    function loadEmailJS() {
      return new Promise((resolve, reject) => {
        if (typeof emailjs !== 'undefined') {
          resolve();
          return;
        }
        
        const cdnUrls = [
          'https://cdn.emailjs.com/npm/@emailjs/browser@4/dist/email.min.js',
          'https://cdn.emailjs.com/dist/email.min.js',
          'https://unpkg.com/@emailjs/browser@4/dist/email.min.js'
        ];
        
        let currentIndex = 0;
        
        function tryLoadFromCDN() {
          if (currentIndex >= cdnUrls.length) {
            reject(new Error('All EmailJS CDNs failed to load'));
            return;
          }
          
          const script = document.createElement('script');
          script.src = cdnUrls[currentIndex];
          script.onload = () => {
            console.log(`EmailJS loaded from CDN: ${cdnUrls[currentIndex]}`);
            resolve();
          };
          script.onerror = () => {
            currentIndex++;
            tryLoadFromCDN();
          };
          document.head.appendChild(script);
        }
        
        tryLoadFromCDN();
      });
    }
    
    // Load dependencies when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        loadEmailJS();
      });
    } else {
      loadEmailJS();
    }
  </script>
</head>

<body>
  <!-- Same body content as index.html -->
  <div class="container">
    <header>
      <h1>BTwist</h1>
      <p id="dynamicTagline" class="dynamic-tagline">Bakliwal Tutorials Email Management System</p>
    </header>

    <main class="editor-container">
      <!-- Main Editor Card -->
      <div class="main-editor">
        <form id="emailForm">
          <h2 class="section-title">Email Configuration</h2>
          <div class="form-section">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="recipientEmail">To Email (up to 2 emails)</label>
                <div class="email-input-container">
                  <div class="email-tags" id="emailTags"></div>
                  <input type="text" id="recipientEmail" name="to_email" class="email-input-field" 
                         placeholder="Enter email address and press comma">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label" for="senderName">From Name</label>
                <input type="text" id="senderName" name="from_name" class="form-input" required 
                       value="Academics Bakliwal" readonly>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="emailSubject">Subject</label>
              <input type="text" id="emailSubject" name="subject" class="form-input" required 
                     placeholder="Bakliwal Tutorials: result for Btest on [Date]" readonly>
            </div>
          </div>

          <div class="section-divider"></div>

          <h2 class="section-title">Student Details</h2>
          <div class="form-section">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="studentName">Student Name</label>
                <input type="text" id="studentName" name="student_name" class="form-input" required 
                       placeholder="John Doe">
              </div>
              <div class="form-group">
                <label class="form-label" for="testDate">Test Date</label>
                <input type="date" id="testDate" name="test_date" class="form-input" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="btestNumber">Btest Number</label>
                <input type="text" id="btestNumber" name="btest_number" class="form-input" required 
                       placeholder="Btest-12" value="Btest-12">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="batchName">Batch Name</label>
                <input type="text" id="batchName" name="batch_name" class="form-input" required 
                       placeholder="C26 Aundh Noon Champions (11:00 am to 2:20 pm)">
              </div>
              <div class="form-group">
                <label class="form-label" for="totalStudents">Total Students</label>
                <input type="number" id="totalStudents" name="total_students" class="form-input" required 
                       placeholder="2210">
              </div>
            </div>
          </div>

          <div class="section-divider"></div>

          <h2 class="section-title">Marks & Rankings</h2>
          <div class="form-section">
            <h3 style="margin-bottom: 16px; color: var(--text-primary); font-size: 1rem; font-weight: 500;">Exam Configuration</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="totalExamMarks">Total Exam Marks</label>
                <input type="number" id="totalExamMarks" name="total_exam_marks" class="form-input" required 
                       placeholder="300" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="physicsMaxMarks">Physics Max Marks</label>
                <input type="number" id="physicsMaxMarks" name="physics_max_marks" class="form-input" required 
                       placeholder="100" min="1">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="chemistryMaxMarks">Chemistry Max Marks</label>
                <input type="number" id="chemistryMaxMarks" name="chemistry_max_marks" class="form-input" required 
                       placeholder="100" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="mathsMaxMarks">Maths Max Marks</label>
                <input type="number" id="mathsMaxMarks" name="maths_max_marks" class="form-input" required 
                       placeholder="100" min="1">
              </div>
            </div>

            <h3 style="margin: 24px 0 16px; color: var(--text-primary); font-size: 1rem; font-weight: 500;">Marks Secured</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="physicsMarks">Physics</label>
                <input type="number" id="physicsMarks" name="physics_marks" class="form-input" required 
                       placeholder="27" min="0">
              </div>
              <div class="form-group">
                <label class="form-label" for="chemistryMarks">Chemistry</label>
                <input type="number" id="chemistryMarks" name="chemistry_marks" class="form-input" required 
                       placeholder="22" min="0">
              </div>
              <div class="form-group">
                <label class="form-label" for="mathsMarks">Maths</label>
                <input type="number" id="mathsMarks" name="maths_marks" class="form-input" required 
                       placeholder="53" min="0">
              </div>
            </div>

            <h3 style="margin: 24px 0 16px; color: var(--text-primary); font-size: 1rem; font-weight: 500;">Rank Among All Offline Students</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="physicsRankAll">Physics Rank</label>
                <input type="number" id="physicsRankAll" name="physics_rank_all" class="form-input" required 
                       placeholder="1122" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="chemistryRankAll">Chemistry Rank</label>
                <input type="number" id="chemistryRankAll" name="chemistry_rank_all" class="form-input" required 
                       placeholder="1437" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="mathsRankAll">Maths Rank</label>
                <input type="number" id="mathsRankAll" name="maths_rank_all" class="form-input" required 
                       placeholder="934" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="overallRankAll">Overall Rank</label>
                <input type="number" id="overallRankAll" name="overall_rank_all" class="form-input" required 
                       placeholder="1049" min="1">
              </div>
            </div>

            <h3 style="margin: 24px 0 16px; color: var(--text-primary); font-size: 1rem; font-weight: 500;">Rank Within Current Batch</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="physicsRankBatch">Physics Rank</label>
                <input type="number" id="physicsRankBatch" name="physics_rank_batch" class="form-input" required 
                       placeholder="9" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="chemistryRankBatch">Chemistry Rank</label>
                <input type="number" id="chemistryRankBatch" name="chemistry_rank_batch" class="form-input" required 
                       placeholder="14" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="mathsRankBatch">Maths Rank</label>
                <input type="number" id="mathsRankBatch" name="maths_rank_batch" class="form-input" required 
                       placeholder="4" min="1">
              </div>
              <div class="form-group">
                <label class="form-label" for="overallRankBatch">Overall Rank</label>
                <input type="number" id="overallRankBatch" name="overall_rank_batch" class="form-input" required 
                       placeholder="2" min="1">
              </div>
            </div>

            <h3 style="margin: 24px 0 16px; color: var(--text-primary); font-size: 1rem; font-weight: 500;">Download Links</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="omrLink">OMR Sheet Link</label>
                <input type="url" id="omrLink" name="omr_link" class="form-input" required 
                       placeholder="https://drive.google.com/file/d/...">
              </div>
              <div class="form-group">
                <label class="form-label" for="responseLink">Response Report Link</label>
                <input type="url" id="responseLink" name="response_link" class="form-input" required 
                       placeholder="https://drive.google.com/file/d/...">
              </div>
              <div class="form-group">
                <label class="form-label" for="analysisLink">Analysis Report Link</label>
                <input type="url" id="analysisLink" name="analysis_link" class="form-input" required 
                       placeholder="https://drive.google.com/file/d/...">
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="btn-group">
            <button type="submit" id="sendBtn" class="btn btn-primary">
              <span class="material-icons">send</span>
              Send Email
            </button>
          </div>

          <!-- Status Messages -->
          <div id="statusMessage" class="status-message hidden"></div>
        </form>

        <!-- Email Preview -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span class="material-icons">visibility</span>
              Email Preview
            </h2>
          </div>
          <div class="card-content" style="padding: 0;">
            <div class="preview-container">
              <div class="preview-header">
                <div class="preview-field">
                  <span class="preview-field-label">To:</span>
                  <span class="preview-field-value" id="previewTo">recipient@example.com</span>
                </div>
                <div class="preview-field">
                  <span class="preview-field-label">From:</span>
                  <span class="preview-field-value" id="previewFrom">Your Name</span>
                </div>
                <div class="preview-field">
                  <span class="preview-field-label">Subject:</span>
                  <span class="preview-field-value" id="previewSubject">Email Subject</span>
                </div>
              </div>
              <div class="preview-body" id="previewBody">
                <p style="color: var(--text-muted); font-style: italic;">Fill out the form fields to see the email preview here...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- EmailJS Configuration Modal -->
    <div id="configModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">
            <span class="material-icons">settings</span>
            EmailJS Configuration
          </h3>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 24px; color: var(--text-secondary);">
            Connect your email account through EmailJS to send emails directly from BTwist.
          </p>
          <div class="form-section">
            <div class="form-group">
              <label class="form-label" for="serviceId">Service ID</label>
              <input type="text" id="serviceId" class="form-input" placeholder="your_service_id">
            </div>
            <div class="form-group">
              <label class="form-label" for="templateId">Template ID</label>
              <input type="text" id="templateId" class="form-input" placeholder="your_template_id">
            </div>
            <div class="form-group">
              <label class="form-label" for="publicKey">Public Key</label>
              <input type="text" id="publicKey" class="form-input" placeholder="your_public_key">
            </div>
          </div>
          <div class="config-help">
            <h4>Setup Instructions</h4>
            <ol>
              <li>Visit <a href="https://www.emailjs.com/" target="_blank">EmailJS.com</a> and create an account</li>
              <li>Add your email service in your EmailJS dashboard</li>
              <li>Create an email template with these variables: 
                <code>{{to_email}}</code>, <code>{{from_name}}</code>, <code>{{subject}}</code>, <code>{{message_html}}</code>
                <br><strong>Template Content:</strong> Use <code>{{{message_html}}}</code> (with triple braces) for HTML rendering
                <br>Example template body: <code>{{{message_html}}}</code>
              </li>
              <li>Copy your Service ID, Template ID, and Public Key to the fields above</li>
              <li><strong>Critical Steps for HTML Formatting:</strong>
                <ul style="margin-top: 8px; margin-left: 20px;">
                  <li>Set "To Email" field to <code>{{to_email}}</code></li>
                  <li>In template content, use <code>{{{message_html}}}</code> with <strong>triple braces {{{ }}}</strong></li>
                  <li>In EmailJS dashboard, go to Email Templates → [Your Template] → Content Type → Select <strong>"HTML"</strong></li>
                  <li>Make sure the template body contains only: <code>{{{message_html}}}</code></li>
                  <li>Test with a simple HTML like <code>&lt;b&gt;Bold text&lt;/b&gt;</code> to verify HTML rendering</li>
                </ul>
              </li>
            </ol>
            <p style="margin-top: 16px; font-size: 12px; color: var(--text-secondary);">
              <strong>Note:</strong> Your EmailJS template must include the specified variables for emails to display correctly.
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="closeModalBtn" class="btn btn-secondary">
            <span class="material-icons">close</span>
            Close
          </button>
          <button type="button" id="saveConfigBtn" class="btn btn-primary">
            <span class="material-icons">save</span>
            Save Configuration
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Inline JavaScript for deployment -->
  <script type="module">
    // Copy the entire content of script.js here for deployment
  </script>
</body>

</html>
